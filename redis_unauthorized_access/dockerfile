# 使用官方的 Redis5.0 镜像作为基础镜像
FROM redis:5.0

# 更新apt包管理器并安装必要的软件包，使用清华镜像源加速下载
RUN echo "">/etc/apt/sources.list; \
    echo "deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye main contrib non-free">>/etc/apt/sources.list; \
    echo "deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-updates main contrib non-free">>/etc/apt/sources.list; \
    echo "deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-backports main contrib non-free">>/etc/apt/sources.list; \
    echo "deb https://security.debian.org/debian-security bullseye-security main contrib non-free">>/etc/apt/sources.list

RUN apt update && \
    apt install -y apache2 apache2-utils && \
    apt clean

# 将启动脚本复制到容器中
COPY start_services.sh /usr/local/bin/

# 赋予启动脚本可执行权限
RUN chmod +x /usr/local/bin/start_services.sh

# 暴露容器的80，6379端口
EXPOSE 80 6379

# 启动脚本作为容器启动时的命令
CMD ["/usr/local/bin/start_services.sh"]
